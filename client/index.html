<!DOCTYPE html>
<html>
<head>
  <title>Test page</title>
  <script src="http://js.leapmotion.com/leap-0.6.3.min.js"></script>
  <script src="http://js.leapmotion.com/leap-plugins-0.1.11.js"></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js'></script>
  <script   src="https://code.jquery.com/jquery-3.0.0.min.js"   integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0="   crossorigin="anonymous"></script>

</head>
<body>
  <button id='saveGesture'>Save!</button>
<script>

  $('#saveGesture').click(() => {
    var gestureController = new Leap.Controller({enableGestures: true});

    gestureController.on('gesture', (gesture) => {
      console.log('connecting custom'/*3 sec...*/);
      customController.connect();
      //probably will want to replace above line with below line
      // setTimeout(customController.connect, 3000);
    });

    gestureController.connect();

    var customController = new Leap.Controller({enableGestures: true});

    customController.on('frame', (frame) => {
      gestureController.disconnect();
      //stop listening for custom gesture
      // console.log(frame.fingers);
      let fingerDirections = frame.fingers.reduce((acc, finger) => {
          // console.log(finger);
        return acc = acc.concat(finger.direction);
      },[])

      let data = [];
      if(frame.hands[0].palmPosition && frame.hands[0].palmVelocity && fingerDirections) {
        data = data.concat(frame.hands[0].palmPosition, frame.hands[0].palmVelocity, fingerDirections);
        console.log(data);
      }
      if (_(frame.pointables).every(finger => !finger.extended)) {
        fetch('http://localhost:8000/gest', {
          method: 'POST',
          body: JSON.stringify(data),
          headers: {"Content-type": "application/json"}
        });
        console.log('disconnecting custom and connecting gesture');
        customController.disconnect();
        gestureController.connect();
      }

      var indexF = frame.hands[0].indexFinger;
      // console.log(indexF.direction[0]);

    });
  });

</script>

</body>
</html>


